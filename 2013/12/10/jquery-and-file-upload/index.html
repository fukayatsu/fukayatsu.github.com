<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge;chrome=1' http-equiv='X-UA-Compatible'>
<link href='/stylesheets/all.css?1384954982' media='all' rel='stylesheet' type='text/css'>
</head>
<link href='/images/favicon.ico' rel='icon' type='image/ico'>
<title>
jquery-and-file-upload - fukayatsu.dev
</title>
</link>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-36253613-1']);
  _gaq.push(['_setDomainName', 'blog.fukayatsu.com']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<body>
<div class='content'>
<header>
<div class='header-inner'>
<div class='header-image'>
<a href="/"><img src='/images/fukayatsu.jpg'>
</a>
</div>
<div class='header-text'>
<a href="/"><h1 class='header-title'>
fukayatsu.dev
</h1>
</a>
<a target="_new" href="http://blog.fukayatsu.com/"><p class='header-description'>
under development
</p>
</a>
</div>
</div>
</header>
<div class='publish-date'>
<a href="/2013/12/10/jquery-and-file-upload/">2013-12-10 21:57:00 +0900</a>
</div>
<div class='tags'>
<a href="/tags/jquery/">jquery</a>
<a href="/tags/file-upload/">file-upload</a>
</div>
<div id='main' role='main'>
<h1 class='title'>jquery-and-file-upload</h1>
<blockquote>
<p><a href="/2013/11/29/advent-calendar-2013/">fukayatsu Advent Calendar 2013</a> - 10日目</p>
</blockquote>

<p>jQueryでformを作らずにfileをuploadしたかったので、<br>
大体こんな感じのコードを書いた。</p>
<pre class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;file&quot;</span> <span class="na">id=</span><span class="s">&quot;file_to_upload&quot;</span><span class="nt">&gt;</span>
</pre><pre class="highlight javascript"><span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#file_to_upload&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">);</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">&#39;/server/uploader&#39;</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="nx">formData</span><span class="p">,</span>
  <span class="na">contentType</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">processData</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<p>注意すべきは<code>contentType: false</code>と<code>processData: false</code>で、<br>
これらを指定しないとjQueryがデフォルト値を使ってしまってエラーになる。</p>

<p>あと、IE10未満だと<code>FormData</code>クラスは使えないようだ。</p>

<h2>参考</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/5392344/sending-multipart-formdata-with-jquery-ajax">Sending multipart/formdata with jQuery.ajax - Stack Overflow</a></li>
</ul>

</div>
<footer>
<div class='footer-inner'>
<p class='copyright'>
<a target="_new" href="https:/twitter.com/fukayatsu">© fukayatsu</a>
</p>
<p class='powerd'>
Powered by
<a target="_new" href="https://github.com/fukayatsu/fukayatsu.github.io/tree/source">GitHub</a>
&
<a target="_new" href="https://travis-ci.org/fukayatsu/fukayatsu.github.io">Travis CI</a>
&
<a target="_new" href="http://middlemanapp.com/">Middleman</a>
</p>
</div>
</footer>
</div>
</body>
</html>
